

---

# Page 1

# 银行云闪付-键查卡业务 说明


## 1. 业务背景

中国银联为服务商业银行帮助其更便捷地查询客户是否将银行卡绑定至云闪付 , APP ， 支持商业银行与云闪付各类服务内容的互联互通， 特下发关于云闪付与商业银行互联互通改 造指南供入网机构开展相应提供技术支持。 银行银行卡前置系统根据技术改造指南针对我行 目前业务执行我行改造技术方案。


## 2. 通讯机制

采用专线接入， HTTP POST 协议方式接入。


## 3. 报文格式

JSON


## 4. 安全机制

---

# Page 2

# 4.1. 签名机制

采用证书签名进行加签、验签。闪付生成-对非对称密钥，公钥提供给商业银行；商业 银行生成-对非对称密钥，公钥提供给云闪付。

将所有待签名参数 （所有字段明文参与签名、 字符编码为 UTF-8 ） 按照字段名的 ASCII 码 从小到大排序（字典序）后，使用键值对的格式（即 key1=value1&key2=value2 …）拼接成字 符串 string1 。对拼接字符串 string1 进行 SM2 签名后，按 base64 格式出现在报文中。


## 4.2. 对称秘钥

请求报文中，云闪付生成对称密钥（长度 16 位 SM4 对称秘钥） ，用于敏感数据加密保 护。此对称密钥为-次-密通过银行方给出的公钥 , SM2 加密后按 16 进制格式出现在报文 中。

应答报文中，由银联卡整合平台调用加密机生成对称密钥（长度 16 位 SM4 对称秘钥） ， 用于敏感数据加密保护。此对称密钥为-次-密通过银联方给出的公钥 , SM2 加密后按 16 进制格式出现在报文中。

加密内容主要包括敏感信息域：全卡号、账户类型、手机号、姓名、证件类型、证件 号等。


## 5. 查询模式


## 5.1. 掩码模式

查询模式 findModel 为 1掩码模式时，字段返回包含掩码（ ）的前四后四卡号，返回 * 格 式为： 6222 **** 1234 ，其中（ ）数量-般为 * 4 个。

---

# Page 3

# 5.2. 明文模式

查询模式 findModel 为 0明文模式时，返回全卡号。根据规范要求其中当为明文模式时候，预 留手机号为必返字段，当查询此字段为空时，则返回空值。


## 6. 涉及系统


## 6.1. 核心系统

提供通过姓名、证件号、证件号类型查询这个人在我行开立的所有的账户信息的接口。

核心接口名称：待定；


## 6.2. 加密平台

提供生成对称秘钥的函数名称。

提供用对称秘钥对敏感信息域加密的函数名称。


## 6.3. 银联卡前置平台

负责整个云闪付查卡交易行内业务流程调度、业务逻辑处理。


## 7. 接入模式简介

银行卡前置系统提供查询接口，供云闪付调用发起银行卡列表查询。

用户在云闪付 APP 内通过认证后，在应用页面中选择需要查询的银行并授权个人信息 （姓名、证件号、证件类型） ，由云闪付后台调用银行提供的查卡后台接口发送请求，将云 闪付用户实名信息（姓名、证件号、证件类型）发送至银行后台，银行后台接口根据查询模 式为明文模式或掩码模式，返回对应身份证下的全量银行账户列表。 （如银行账号（含掩码

---

# Page 4

的前四后四或全卡号） 、账户类型、账户状态等字段） 。


# 8. 交易流程


-  用户登录云闪付，并经过云闪付前端完成用户授权并向后台发起查询请求； 。
-  云闪付后台调用 findCard 接口，向银行后台请求全量账户列表。
-  银联卡整合平台收到请求交易后，通过解析报文并将敏感信息域如证件号、证件类 型等解密成明文。并根据核心提供的查询卡接口封装请求报文并发送至核心。
-  核心根据请求将应答报文返回给银联卡整合平台， 银联卡整合平台根据报文接口规 范对敏感信息进行加密处理。对敏感信息域加密后，银联卡整合平台将加签业务处 理逻辑对报文域进行加签。并按接口规范重新封装返回报文并返回给云闪付后台。
-  云闪付后台进行整理生成报告后返回给云闪付前台， 云闪付前端展示用户全量银行 账户报告。

---

# Page 5

# 9. 接口说明


## 9.1. 请求接口


| 英文名称   | 中文名称   | 类型   | 是否可选   | 说明                                                                                                                              |
|------------|------------|--------|------------|-----------------------------------------------------------------------------------------------------------------------------------|
| sn         | 订单号     | String | 必填       | APP 请求银行查询订单的编 号                                                                                                       |
| appId      | 接入方 ID  | String | 必填       | 接入方 ID 。由云闪付 APP 为 接入机构分配。                                                                                        |
| realNm     | 真实姓名   | String | 必填       | 用户在云闪付实名认证后的 用 户 预 留 姓 名 ， 使 用 symmetricKey 对称加密，内                                                     |
| certType   | 证件类型   | String | 必填       | 04 ：港澳居民来往内地通行证 （回乡证） 05 ：台湾同胞来往内地通行证 （台胞证） 06 ：警官证 07 ：士兵证 08 ：户口簿 09 ：临时身份证 |

---

# Page 6

|             |            |        |      | 使用 symmetricKey 对称加 密，内容为 base64 格式；                         |
|-------------|------------|--------|------|---------------------------------------------------------------------------|
| certifId    | 证件号     | String | 必填 | 证件号，使用 symmetricKey 对称加密，内容为 base64 格                      |
| authorizeNo | 授权号     | String | 必填 | 意授权勾选协议并完成认证 后生成的唯-编号，后续可 用此编号在云闪付查询授权 |
| findModel   | 查询模式   | String | 选填 | 查询模式，告知被查询方， 当前是为 了什么目的查询。 0 为明文模式           |
| extensions  | 扩展字段   | String | 选填 | 扩展字段，机构特殊字段如 卡权益标识等信息放扩展 字段（本字段长度校验限制  |
| nonceStr    | 随机字符串 | String | 必填 | 随机字符串                                                                |
| timestamp   | 时间戳     | String | 必填 | 时间戳                                                                    |
| signature   | 签名       | String | 必填 | 签名。除 signature 外所有字                                               |

---

# Page 7

|              |          |        |      | 段明文参与签名，签名机制 参考 3.2 章节                    |
|--------------|----------|--------|------|-----------------------------------------------------------|
| symmetricKey | 对称密钥 | String | 必填 | SM4 对称密钥 key 。使用 SM2 公钥加密，内容为 16 进制格 式 |



# 9.2. 应答接口


| 中文名称     | 英文名称   | 类型   | 是否必填   | 说明                                                                                |
|--------------|------------|--------|------------|-------------------------------------------------------------------------------------|
| 返回应答码   | resp       | String | 必填       | 银行后台解析并校 验报文后，返回的请 求结果。 00- 成功，非 成功应答码请见应 答码说明 |
| 返回应答信息 | msg        | String | 必填       |                                                                                     |
| 接入方 ID    | appId      | String | 必填       | 接入方 ID 。由云闪付 APP 为接入机构分 配，可复用-键绑卡                             |
| 用户 ID      | userId     | String | 选填       | 合作机构系统内的 唯-标识用户 ID 。                                                  |

---

# Page 8

|              |               |            | 0- 明文模式时为必 填， 若无则返回空 值。                |
|--------------|---------------|------------|---------------------------------------------------------|
| 注册手机号   | registerMobil | String     | 选填 base64 格式                                        |
| 银行账户总量 | cardCount     | String     | 必填 银行账户数量，代表 用户在这个银行全                |
| 银行卡数组   | cardList      | List<Card> | 必填 银行卡数组                                         |
| 扩展字段     | extensions    | String     | 选填 机构特殊字段如卡 权益标识等信息放 扩展字段（本字段 |

---

# Page 9

| 随机字符串       | nonceStr      | String   | 必填   | 随机字符串                                                         |
|------------------|---------------|----------|--------|--------------------------------------------------------------------|
| 时间戳           | timestamp     | String   | 必填   | 时间戳                                                             |
| 签名             | signature     | String   | 必填   | 签名。除 signature 外所有字段明文参 与签名，签名机制参 考 3.2 章节 |
| SM4 对称密钥 key | symmetricKe y | String   | 必填   | SM4 对称密钥 key 。 使用 SM2 公钥加密，                            |



# 其中 cardList 接口如下：


| 卡号   | cardNo   | String   | 银行根据'查询模式' （ findModel ） 返回银行 卡号， 非银联卡也要返回 号， （例如其他卡组织的   |
|--------|----------|----------|-----------------------------------------------------------------------------------------------|
| 卡号   | cardNo   | String   | 银行卡或其他带有结算                                                                          |
| 卡号   | cardNo   | String   | 功能的账户，如存折）。                                                                        |
| 卡号   | cardNo   | String   | 要求至少是 当查询模式                                                                         |
| 卡号   | cardNo   | String   | findModel 为 0- 明文模式                                                                      |
| 卡号   | cardNo   | String   | 绑卡时要返回全卡号。 当                                                                       |
| 卡号   | cardNo   | String   | 查询模式为 1- 掩码模式                                                                        |
| 卡号   | cardNo   | String   |                                                                                               |
| 卡号   | cardNo   | String   |                                                                                               |
| 卡号   | cardNo   | String   |                                                                                               |

---

# Page 10

| 银行账户预   |               |        | 时，字段返回包含掩码 （ ）的前四后四卡号， * 返回 格式固定为： 6222 **** 1234 使用 symmetricKey 对称 加密，内容为 base64 格 式 用户银行账户的预留手   |
|--------------|---------------|--------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 留手机号     | reserveMobile | String | 选填 机号。 要求当查询模式为 0- 明文模式时为必填 ，若 无则返回空值。 使用 symmetricKey 对 称 加                                                       |
| 发卡机构表   | issInsIdCd    | String | 选填 发卡机构标识码                                                                                                                                   |
| 卡性质       | cardAttr      | String | 必填 00 ：未知 01 ：借记卡                                                                                                                            |

---

# Page 11

|          |              |        | 05 ：预付费 06 ：单用途预付费卡                                                   |
|----------|--------------|--------|-----------------------------------------------------------------------------------|
| 账户等级 | accountLevel | String | 必填 0 ：信用卡账户                                                               |
| 账户介质 | accountMedia | String | 必填 账户介质： 0 ：其他（除虚拟卡外可默 认送此） 1 ：有卡 4 ：无卡（虚拟卡选此） |
| 卡状态   | cardSt       | String | 必填 05 ：销卡 99 ：其他                                                          |

---

# Page 12

|            |            |        |      | 信息。）                                                                                                                                                                                                     |
|------------|------------|--------|------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 账户归属地 | areaCode   | String | 必填 | 地区码， 建议至少定位到 省市、直辖市级地区区 位。不填默认为 0000 ， 长度为 位， 接入方根据 4 实际需求按照 《银联卡跨 行业务地区代码标准》 上 送至区级区位，使用 symmetricKey 对 称 加 密，内容为 base64 格式 |
| 扩展字段   | extensions | String | 选填 | 扩展字段，机构特殊字 段如卡权益标识等信息 放扩展字段（本字段长 度校验限制不得小于                                                                                                                            |



# 10.应答码说明


## 10.1. 银联应答码


|   应答码 | 类型                                                                     |
|----------|--------------------------------------------------------------------------|
|       00 | 请求成功。                                                               |
|       02 | 参数不能为空。检查请求接口中的必填字段是否为空。                         |
|       03 | 请求非法。检查时间戳，与北京时间相差 分钟以上则拒绝请求。 5              |
|       04 | 验证签名不通过。签名有误，请检查签名。                                   |
|       05 | 解密对称密钥失败，无法解密对称密钥，请检查对称密钥 SM2 加密方法。        |
|       06 | 解密敏感数据失败，无法使用对称密钥解密敏感信息，请检查敏感信息加密方法。 |
|       11 | 您的实名信息未查询到或不匹配。                                           |

---

# Page 13

99

系统异常


# 11.测试说明

开发阶段通过银联提供的仿真测试工具进行测试。

UAT 阶段通过向银联提交仿真测试报告，根据银联审核结果银联将提供联机测试环境进 行测试。